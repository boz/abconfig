---

- name: install zsh (pacman)
  pacman: name={{item}}
  with_items:
    - zsh
    - zsh-completions
  become: true
  when: ansible_pkg_mgr == "pacman"
  tags: [config-install,zsh]

- name: install zsh (apt)
  apt: name={{item}}
  with_items:
    - zsh
    - zsh-common
    - zsh-doc
  become: true
  when: ansible_pkg_mgr == "apt"
  tags: [config-install,zsh]

- name: check zprezto repository presence
  stat: path={{ zprezto_dir }}
  register: have_zprezto
  become: "{{target_user}}"
  tags: [config-install,zsh,zprezto,multiuser]

- name: clone zprezto
  git: repo={{ zprezto_repo }}
       dest={{ zprezto_dir }}
       recursive=true
  become: "{{target_user}}"
  when: not have_zprezto.stat.exists
  tags: [config-install,zsh,zprezto,multiuser]

- name: install zprezto
  file: state=link
        src={{ zprezto_dir }}/runcoms/{{item}}
        dest={{ homedir }}/.{{item}}
  with_items:
    - zlogin
    - zlogout
    - zpreztorc
    - zprofile
    - zshenv
    - zshrc
  become: "{{target_user}}"
  tags: [config-install,zsh,zprezto,multiuser]

- name: create bin dir
  file:
    path: "{{homedir}}/bin"
    state: directory
  become: "{{target_user}}"
  tags: [config-install,zsh,multiuser]

- name: create profile dir
  file: path={{profiledir}} state=directory
  become: "{{target_user}}"
  tags: [config-install,zsh,multiuser]

- name: install base config
  copy: src={{item}}
        dest={{ profiledir }}/{{item | basename}}
  with_fileglob: "*.zsh"
  become: "{{target_user}}"
  tags: [config,zsh,multiuser]
